'use strict';

var lodashEs = require('lodash-es');

var U=Object.defineProperty,q=Object.defineProperties;var v=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable;var S=(n,t,i)=>t in n?U(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i,u=(n,t)=>{for(var i in t||(t={}))Q.call(t,i)&&S(n,i,t[i]);if(j)for(var i of j(t))_.call(t,i)&&S(n,i,t[i]);return n},$=(n,t)=>q(n,v(t));function m(n,t){return Object.entries(n).reduce((i,[e,r])=>{let a=t?`${t}.${e}`:e;return u(u({},i),typeof r=="object"&&r!==null?m(r,a):{[a]:r})},{})}var w=class{constructor(t,i){this.apiConfig={};this.apiMap={};this.http=null;this.methods=["get","post","put","delete","patch","head","options","trace","connect"];this.api={};this.setApiConfig(i),this.setHttp(t);}setMethod(t){t.length&&(this.methods.push(...t),Object.entries(this.apiMap).filter(([i,e])=>t.some(r=>e.startsWith(r))).forEach(([i,e])=>this.setApi(i,e)));}setHttp(t){this.http=t;}setApiConfig(t){this.apiConfig=t;let i=m(t);Object.entries(i).forEach(([e,r])=>this.setApi(e,r));}setApi(t,i){lodashEs.set(this.apiConfig,t,i);let e=this.methods.some(r=>i.startsWith(r));this.apiMap[t]=(e?"":"get ")+i,this.generateApi(t);}getApi(t){return this.api[t]}getUrl(t,i,e){var f;let r=this.apiMap[t];if(!r)throw new Error(`api ${t} is not exist`);let a=this,p=/:(\w+\|?\w+(=\w+)?)|(\{\w+\|?\w+(=\w+)?\})/g,[o,s]=((f=r.split(" ").at(1))==null?void 0:f.split("?"))||[],[g,l]=[{str:o,data:e},{str:s,data:i}].map(({str:h,data:c},C)=>h==null?void 0:h.replace(p,d=>{let R=d.toString().replace(/[:{}]/g,""),[x,y=""]=R.split("="),M=x.split("|");return M.length?M.reduce((P,A)=>{var b;return (!c||c[A]===void 0)&&C===0&&!y&&a.throwError(`\u8DEF\u5F84\u53C2\u6570 ${A} \u7F3A\u5931,URL=${h}`),c&&c[A]!==void 0&&(P=((b=c[A])==null?void 0:b.toString())||y||""),P},y):""}));return encodeURI(g+(l?`?${l}`:""))}getData(t,i){var p;if(!i)return null;if(!lodashEs.isPlainObject(i))return lodashEs.isPlainObject||null;let r=this.apiMap[t].split(" ").at(2);return (((p=r==null?void 0:r.replace(/^\{|\}$/,""))==null?void 0:p.split(",").map(o=>{let[s,g=""]=o.split("=");return {field:s,defaultValue:g}}))||[]).reduce((o,{field:s,defaultValue:g})=>(o[s]=g,i[s]!==void 0&&(o[s]=i[s]),o),{})}throwError(t){throw new Error(t)}generateApi(t){let i=this.apiMap[t],[e,r,a]=i.split(" "),p=this;lodashEs.set(this.api,t,(o,s)=>{var d;let{query:g,path:l,data:f}=o||{},h=p.getUrl(t,g,l),c=p.getData(a,f),C=$(u({},s||{}),{url:h,method:e,data:c});return (d=p.http)==null?void 0:d.request(C)});}};

exports.SuperAPiBuilder = w;
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.js.map